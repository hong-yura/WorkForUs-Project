<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.workforus.forus.mapper.BoardPostMapper">

	<resultMap type="boardPostDto" id="boardPostDtoMap">
		<id property="postId" column="post_id"/>
		<result property="writer" column="emp_id"/>
		<result property="boardId" column="board_id"/>
		<result property="postTitle" column="post_title"/>
		<result property="postPw" column="post_pw"/>
		<result property="content" column="post_content"/>
		<result property="addDate" column="post_add_dt"/>
		<result property="modifyDate" column="post_modify_dt"/>
		<result property="removeDate" column="post_remove_dt"/>
		<result property="viewCnt" column="view_cnt"/>
		<result property="noticeYn" column="notice_yn"/>
		<result property="temporaryYn" column="temporary_post_yn"/>
		<result property="reportYn" column="report_yn"/>
		<result property="likeCnt" column="like_cnt"/>
		<association property="empObj" javaType="empDto">
			<id property="empId" column="emp_id"/>
			<result property="empNm" column="emp_nm"/>
		</association>
	</resultMap>
	<resultMap type="postCommentDto" id="postCommentDtoMap">
		<result property="commentId" column="comment_id"/>
		<result property="postId" column="post_id"/>
		<result property="content" column="comment_content"/>
		<result property="empId" column="emp_id"/>
		<result property="empNm" column="emp_nm"/>
		<result property="groupNo" column="group_no"/>
		<result property="depth" column="comment_depth"/>
		<result property="sort" column="comment_sort"/>
		<result property="anonymity_yn" column="anonymity_yn"/>
		<result property="addDate" column="comment_add_dt"/>
	</resultMap>
	
	<select id="selectPostAll" resultMap="boardPostDtoMap">
		SELECT P.POST_ID
			 , P.EMP_ID
			 , P.BOARD_ID 
			 , P.POST_TITLE
			 , P.POST_PW
			 , P.POST_CONTENT
			 , P.POST_ADD_DT
			 , P.POST_MODIFY_DT
			 , P.POST_REMOVE_DT
			 , P.VIEW_CNT
			 , P.NOTICE_YN
			 , P.TEMPORARY_POST_YN
			 , P.REPORT_YN
			 , P.LIKE_CNT
			 , E.EMP_NM
		  FROM TB_BOARD_POSTS P
		  JOIN TB_EMPLOYEES E
		    ON P.EMP_ID = E.EMP_ID
		 WHERE P.BOARD_ID = #{id}  
	</select>
	<!-- 게시판 상세 데이터 -->
 	 <select id="selectBoardDetail" resultMap="boardPostDtoMap" >
 	 	SELECT P.POST_ID
			 , P.EMP_ID
			 , P.BOARD_ID 
			 , P.POST_TITLE
			 , P.POST_PW
			 , P.POST_CONTENT
			 , P.POST_ADD_DT
			 , P.POST_MODIFY_DT
			 , P.POST_REMOVE_DT
			 , P.VIEW_CNT
			 , P.NOTICE_YN
			 , P.TEMPORARY_POST_YN
			 , P.REPORT_YN
			 , P.LIKE_CNT
			 , E.EMP_NM
		  FROM TB_BOARD_POSTS P
		  JOIN TB_EMPLOYEES E
		    ON P.EMP_ID = E.EMP_ID
		 WHERE P.POST_ID = #{id}
 	 </select>
	
	<select id="selectSearchData" resultMap="boardPostDtoMap">
		SELECT P.POST_ID
			 , P.EMP_ID
			 , P.BOARD_ID 
			 , P.POST_TITLE
			 , P.POST_PW
			 , P.POST_CONTENT
			 , P.POST_ADD_DT
			 , P.POST_MODIFY_DT
			 , P.POST_REMOVE_DT
			 , P.VIEW_CNT
			 , P.NOTICE_YN
			 , P.TEMPORARY_POST_YN
			 , P.REPORT_YN
			 , P.LIKE_CNT
			 , E.EMP_NM
		  FROM TB_BOARD_POSTS P
		  JOIN TB_EMPLOYEES E
		    ON P.EMP_ID = E.EMP_ID
		 WHERE P.BOARD_ID = #{id} 
		   AND P.POST_TITLE LIKE '%' || #{search} || '%'
	</select>
	
	<!-- 일반 게시글 갯수 구하기 -->
 	 <select id="generalPostCount" resultType="_int">
 	 	SELECT COUNT(*)
		  FROM TB_BOARD_POSTS
		 WHERE BOARD_ID = 1
		   AND NOTICE_YN = 'N'
 	 </select>
 	 
 	 <!-- 게시글 댓글 가져오기  -->
 	 <select id="selectPostComment" resultMap="postCommentDtoMap">
 	 	SELECT * 
		  FROM TB_POST_COMMENTS 
		 WHERE POST_ID = #{id}
		   AND COMMENT_REMOVE_YN = 'N'
		 ORDER BY GROUP_NO, COMMENT_SORT
 	 </select>
 	 
 	 <!-- 댓글 개수 -->
 	 <select id="selectCommentCount" resultType="_int">
 	 	SELECT COUNT(*)
		  FROM TB_POST_COMMENTS
		 WHERE POST_ID = #{id}
		   AND COMMENT_REMOVE_YN = 'N' 
 	 </select>
</mapper>